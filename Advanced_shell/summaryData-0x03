#!/bin/bash

# Output CSV file
output_file="pokemon_report.csv"
timestamp=$(date +"%Y-%m-%d %H:%M:%S")

# CSV header
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Initialize totals for averages
total_height=0
total_weight=0
count=0

# Process each JSON file in the pokemon_data directory
for file in pokemon_data/*.json; do
  # Extract data using jq
  name=$(jq -r '.name | (.[:1] | ascii_upcase) + .[1:]' "$file")
  height=$(jq -r '.height/10' "$file")
  weight=$(jq -r '.weight/10' "$file")

  # Add to CSV
  echo "$name,$height,$weight" >> "$output_file"

  # Add to totals for averages
  total_height=$(awk "BEGIN {print $total_height + $height}")
  total_weight=$(awk "BEGIN {print $total_weight + $weight}")
  ((count++))
done

# Calculate averages
avg_height=$(awk "BEGIN {printf \"%.2f\", $total_height/$count}")
avg_weight=$(awk "BEGIN {printf \"%.2f\", $total_weight/$count}")

# Print completion message and averages
echo "CSV Report generated at: $output_file"
echo
cat "$output_file"
echo
echo "Average Height: $avg_height m"
echo "Average Weight: $avg_weight kg"