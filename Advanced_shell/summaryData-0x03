#!/bin/bash

# Output CSV file
output_file="pokemon_report.csv"

# Initialize CSV header
echo "Name,Height (m),Weight (kg)" > "$output_file"

# Process files and collect data for averages
{
  for file in pokemon_data/*.json; do
    jq -r '[
      (.name | (.[:1] | ascii_upcase) + .[1:]),
      (.height/10 | tostring),
      (.weight/10 | tostring)
    ] | join(",")' "$file"
  done
} >> "$output_file"

# Calculate averages using awk
awk -F, '
NR == 1 { next }  # Skip header
{
  height_sum += $2
  weight_sum += $3
  count++
}
END {
  printf "\nAverage Height: %.2f m\n", height_sum/count
  printf "Average Weight: %.2f kg\n", weight_sum/count
}
' "$output_file"

# Display completion message
echo "CSV Report generated at: $output_file"
cat "$output_file"